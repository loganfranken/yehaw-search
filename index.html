<!DOCTYPE html>
<html>

    <!--
        TODO:
            - Handle no results
            - Add loading indicator
    -->

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Custom Google Search</title>

        <style type="text/css">
            .btn
            {
                background-position: center center;
                background-repeat: no-repeat;
                border: 0;
                cursor: pointer;
                text-indent: -9999em;
            }

            .artist-search
            {
                display: flex;
            }

            .artist-search .btn
            {
                background-color: #272727;
                background-image: url('./magnifying_glass.svg');
                background-size: 25%;
                color: #FFF;
                font-size: 1.1em;
                text-align: center;
                margin-left: 0.5em;
                padding: 0.5em;
                transition: .1s opacity linear;
                width: 5em;
            }

            .artist-search button:hover
            {
                opacity: 0.8;
            }

            .artist-search input
            {
                border: 1px solid #CCC;
                flex: 1 auto;
                font-size: 1.1em;
                padding: 0.5em;
            }

            .artist-search-results
            {
                background: rgba(0, 0, 0, 0.6);
                height: 0;
                font-family: Arial, sans-serif;
                left: 0;
                opacity: 0;
                overflow: hidden;
                position: absolute;
                transition: opacity 0.1s;
                top: 0;
                width: 100%;
            }

            .modal-header
            {
                border-bottom: 1px solid #DDD;
                padding-bottom: 1.5em;
                margin-bottom: 2em;
                overflow: auto;
            }

            .artist-search-results .modal-header h2
            {
                float: left;
                margin: 0;
                width: 90%;
            }

            .artist-search-results .modal-header .btn
            {
                background-color: #FFF;
                background-image: url('./exit_icon.svg');
                background-size: 80%;
                float: right;
                height: 2em;
                width: 2em;
            }

            .artist-search-results.visible
            {
                height: 100%;
                opacity: 1;
            }

            .artist-search-results .modal
            {
                background: #FFF;
                margin: 2em auto;
                max-width: 70em;
                overflow: auto;
                width: 80%;
            }

            .artist-search-results .modal-inner
            {
                margin: 1.5em;
            }

            .modal-content
            {
                height: 30em;
                overflow: auto;
            }

            .search-result
            {
                margin-bottom: 1.5em;
            }

            .search-result a
            {
                color: #000;
                font-family: 1.5em;
                font-weight: bold;
            }

            .search-result .snippet
            {
                display: block;
            }
        </style>


        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script>

            $(function() {
                $('.artist-search').on('submit', function(event) {
                    event.preventDefault();
                    handleSearchSubmit();
                });

                var $artistSearchResults = $('.artist-search-results');

                $('.artist-search-results .btn').on('click', function() {
                    $artistSearchResults.removeClass('visible');
                });

                $('.artist-search-results').on('click', function(event) {
                    if($(event.target).hasClass('artist-search-results'))
                    {
                        $artistSearchResults.removeClass('visible');
                    }
                })
            });

            function handleSearchSubmit()
            {
                var searchTerm = $('#artist-search-term').val();
                doSearch(searchTerm, 1, function(response) {
                    $('.artist-search-results .modal-content').empty();
                    onSearchSuccess(response);
                });
            }

            function doSearch(searchTerm, startIndex, onSearchSuccess)
            {
                $.ajax({
                    url: "https://www.googleapis.com/customsearch/v1/siterestrict",
                    dataType: "jsonp",
                    data: {
                        key: 'AIzaSyCei4ypSxdvj985b9Qr67Lq6oUDNDMa-Ss',
                        cx: '006455971487473204572:zuueohon068',
                        q: searchTerm,
                        start: startIndex
                    },
                    success: onSearchSuccess
                });
            }

            function onSearchSuccess(response)
            {
                var totalResults = parseInt(response.searchInformation.totalResults, 10);
                var searchTerm = response.queries.request[0].searchTerms;
                var startIndex = response.queries.request[0].startIndex;

                displayResults(searchTerm, response.items, startIndex, totalResults);
            }

            function displayResults(searchTerm, items, currStartIndex, totalResults)
            {
                var $results = $('.artist-search-results .modal-content');

                items.forEach(function(item) {

                    var title = item.title;
                    title = title.replace(' — yəhaw̓', '');

                    $results.append('<div class="search-result">' +
                        '<a href="' + item.link + '">' + title + '</a>' +
                        '<span class="snippet">' + item.snippet + '</span>' +
                    '</div>');

                });

                if(!$results.hasClass('visible'))
                {
                    $('.artist-search-results').addClass('visible');
                }

                var nextPageStartIndex = currStartIndex + 10;
                if(nextPageStartIndex < totalResults)
                {
                    doSearch(searchTerm, nextPageStartIndex, onSearchSuccess);
                }
            }

        </script>
    </head>
    <body>

        <form class="artist-search">
            <input id="artist-search-term" name="artist-search-term" aria-label="Search Term" type="text">
            <button class="btn">Search</button>
        </form>

        <div class="artist-search-results">
            <div class="modal">
                <div class="modal-inner">
                    <div class="modal-header">
                        <h2>Search results for "sculpture"</h2>
                        <button class="btn">Close</button>
                    </div>
                    <div class="modal-content">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>